<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI Content & Facebook Scheduler</title>
  <style>
    body { font-family: "Segoe UI", Tahoma, sans-serif; background: #0f172a; color: #f8fafc; margin: 0; padding: 20px; }
    h1 { color: #38bdf8; margin-bottom: 20px; }
    label { display: block; margin: 10px 0 5px; font-weight: bold; }
    input, select, button, textarea { width: 100%; padding: 10px; margin-bottom: 15px; border-radius: 8px; border: none; font-size: 14px; }
    button { background: #3b82f6; color: white; cursor: pointer; transition: 0.2s; }
    button:hover { background: #2563eb; }
    #result { margin-top: 20px; }
    .card {
      background: #1e293b;
      padding: 15px;
      margin-bottom: 15px;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.4);
    }
    .card h2 { margin-top: 0; color: #facc15; }
    .card p { margin: 6px 0; line-height: 1.5; }
    .card ul { margin: 10px 0; padding-left: 20px; }
    .img-block { margin-bottom: 20px; }
    img { max-width: 100%; margin-top: 10px; border-radius: 8px; display: block; }
    .btn-row { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 8px; }
    .download-btn { background: #10b981; }
    .download-btn:hover { background: #059669; }
    .copy-btn { background: #f59e0b; }
    .copy-btn:hover { background: #d97706; }
    .export-btn { background: #9333ea; }
    .export-btn:hover { background: #7e22ce; }
    .hashtag { color: #38bdf8; font-weight: bold; }
  </style>
</head>
<body>
  <h1>‚ú® AI Content & Facebook Scheduler</h1>

  <label>‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ (Topic)</label>
  <input id="topic" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏°‡πÄ‡∏á‡∏¥‡∏ô, ‡πÄ‡∏Ñ‡∏•‡πá‡∏î‡∏•‡∏±‡∏ö‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û" />

  <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 5)</label>
  <select id="count">
    <option value="1">1</option>
    <option value="2">2</option>
    <option value="3">3</option>
    <option value="4">4</option>
    <option value="5">5</option>
  </select>

  <label>‡πÇ‡∏´‡∏°‡∏î</label>
  <select id="mode">
    <option value="text">Text (‡∏ö‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°)</option>
    <option value="image">Image (‡∏†‡∏≤‡∏û‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö)</option>
  </select>

  <label>‡πÇ‡∏°‡πÄ‡∏î‡∏•</label>
  <select id="model">
    <option value="gemini-2.0-flash">Gemini 2.0 Flash</option>
    <option value="gemini-2.0-pro">Gemini 2.0 Pro</option>
    <option value="gemini-1.5-flash">Gemini 1.5 Flash</option>
    <option value="gemini-1.5-pro">Gemini 1.5 Pro</option>
  </select>

  <label>‡πÇ‡∏ó‡∏ô‡∏ö‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°/‡∏†‡∏≤‡∏û</label>
  <select id="style">
    <option value="‡πÅ‡∏ö‡∏ö‡∏≠‡πà‡∏≤‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏á‡πà‡∏≤‡∏¢">‡πÅ‡∏ö‡∏ö‡∏≠‡πà‡∏≤‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏á‡πà‡∏≤‡∏¢</option>
    <option value="‡πÅ‡∏ô‡∏ß‡∏ï‡∏•‡∏Å‡∏Ç‡∏≥‡πÜ">‡πÅ‡∏ô‡∏ß‡∏ï‡∏•‡∏Å‡∏Ç‡∏≥‡πÜ</option>
    <option value="‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£">‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£</option>
    <option value="‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏£‡∏á‡∏ö‡∏±‡∏ô‡∏î‡∏≤‡∏•‡πÉ‡∏à">‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏£‡∏á‡∏ö‡∏±‡∏ô‡∏î‡∏≤‡∏•‡πÉ‡∏à</option>
  </select>

  <label>‡∏†‡∏≤‡∏©‡∏≤</label>
  <select id="language">
    <option value="th">‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢</option>
    <option value="en">English</option>
  </select>

  <label>‡πÅ‡∏û‡∏•‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°</label>
  <select id="platform">
    <option value="facebook">Facebook</option>
    <option value="tiktok">TikTok</option>
    <option value="linkedin">LinkedIn</option>
    <option value="instagram">Instagram</option>
  </select>

  <button onclick="generate()">Generate</button>

  <h2>‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå</h2>
  <div id="result"></div>
  <button id="exportAllBtn" class="export-btn" style="display:none;" onclick="exportAll()">‚¨á Export ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>

  <script>
    async function generate() {
      const topic = document.getElementById("topic").value;
      const count = document.getElementById("count").value;
      const model = document.getElementById("model").value;
      const style = document.getElementById("style").value;
      const mode = document.getElementById("mode").value;
      const language = document.getElementById("language").value;
      const platform = document.getElementById("platform").value;

      const proxyBase = localStorage.getItem("proxyBase") || "https://fb-proxy-xxxx.onrender.com";

      document.getElementById("result").innerHTML = "‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á...";
      document.getElementById("exportAllBtn").style.display = "none";

      try {
        const response = await fetch(proxyBase + "/generate", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ topic, count, model, style, mode, language, platform })
        });

        const data = await response.json();
        const resultDiv = document.getElementById("result");
        resultDiv.innerHTML = "";

        if (mode === "text") {
          if (data.data && data.data.candidates) {
            let allTexts = [];
            data.data.candidates.forEach((c, i) => {
              const content = c.content.parts[0].text;
              allTexts.push(content);

              const card = document.createElement("div");
              card.className = "card";

              // ‚úÖ parse markdown ‚Üí html + highlight hashtags + insert emoji
              let htmlContent = content
                .replace(/^### (.*$)/gim, "<h3>$1</h3>")
                .replace(/^## (.*$)/gim, "<h2>$1</h2>")
                .replace(/^# (.*$)/gim, "<h1>$1</h1>")
                .replace(/\*\*(.*?)\*\*/gim, "<b>$1</b>")
                .replace(/\n\* (.*?)/gim, "<ul><li>$1</li></ul>")
                .replace(/\n- (.*?)/gim, "<ul><li>$1</li></ul>")
                .replace(/#(\S+)/g, '<span class="hashtag">#$1</span>')
                .replace(/\n/gim, "<br>");

              // ‚úÖ Auto Emoji Insert
              htmlContent = htmlContent
                .replace(/‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß|‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß/g, "üåÑ $&")
                .replace(/‡∏≠‡∏≤‡∏´‡∏≤‡∏£|‡∏Å‡∏¥‡∏ô|‡∏Ç‡πâ‡∏≤‡∏ß/g, "üçú $&")
                .replace(/‡∏á‡∏≤‡∏ô|‡πÄ‡∏ó‡∏®‡∏Å‡∏≤‡∏•|‡∏õ‡∏≤‡∏£‡πå‡∏ï‡∏µ‡πâ/g, "üéâ $&")
                .replace(/‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û|‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢|‡∏ü‡∏¥‡∏ï/g, "üí™ $&")
                .replace(/‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô|‡πÄ‡∏á‡∏¥‡∏ô|‡∏•‡∏á‡∏ó‡∏∏‡∏ô/g, "üí∞ $&")
                .replace(/‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á|‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ö‡∏¥‡∏ô|‡∏£‡∏ñ/g, "‚úàÔ∏è $&");

              card.innerHTML = `<h2>‡∏ö‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà ${i+1}</h2><div>${htmlContent}</div>`;

              // ‚úÖ ‡∏õ‡∏∏‡πà‡∏° Copy
              const btnRow = document.createElement("div");
              btnRow.className = "btn-row";

              const copyBtn = document.createElement("button");
              copyBtn.className = "copy-btn";
              copyBtn.innerText = "üìã Copy";
              copyBtn.onclick = () => copyToClipboard(content);

              btnRow.appendChild(copyBtn);
              card.appendChild(btnRow);
              resultDiv.appendChild(card);
            });

            // ‚úÖ ‡∏õ‡∏∏‡πà‡∏° Export TXT
            if (allTexts.length > 0) {
              document.getElementById("exportAllBtn").style.display = "block";
              document.getElementById("exportAllBtn").dataset.texts = JSON.stringify(allTexts);
            }
          } else {
            resultDiv.innerText = "‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏à‡∏≤‡∏Å Gemini";
          }
        } else if (mode === "image") {
          if (data.data && data.data.images) {
            let allImages = [];
            data.data.images.forEach((img, i) => {
              allImages.push(img.b64);

              const block = document.createElement("div");
              block.className = "img-block";

              const el = document.createElement("img");
              el.src = "data:image/png;base64," + img.b64;

              const btnRow = document.createElement("div");
              btnRow.className = "btn-row";

              const btn = document.createElement("button");
              btn.className = "download-btn";
              btn.innerText = "‚¨á ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ " + (i + 1);
              btn.onclick = () => downloadImage(img.b64, `gemini_image_${i + 1}.png`);

              btnRow.appendChild(btn);
              block.appendChild(el);
              block.appendChild(btnRow);
              resultDiv.appendChild(block);
            });
          } else {
            resultDiv.innerText = JSON.stringify(data, null, 2);
          }
        }
      } catch (err) {
        document.getElementById("result").innerText = "‚ùå Error: " + err.message;
      }
    }

    function copyToClipboard(text) {
      navigator.clipboard.writeText(text).then(() => {
        alert("‚úÖ ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!");
      });
    }

    function downloadImage(base64Data, filename) {
      const link = document.createElement("a");
      link.href = "data:image/png;base64," + base64Data;
      link.download = filename;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    function exportAll() {
      const btn = document.getElementById("exportAllBtn");
      if (btn.dataset.texts) {
        const texts = JSON.parse(btn.dataset.texts);
        const blob = new Blob([texts.join("\n\n---\n\n")], { type: "text/plain" });
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = "ai_contents.txt";
        link.click();
      }
    }
  </script>
</body>
</html>
