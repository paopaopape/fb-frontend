<div id="results"></div>

<script>
  async function generate() {
    document.getElementById("error").textContent = "";
    document.getElementById("results").innerHTML = "<p>‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ó‡∏ô‡∏ï‡πå...</p>";

    const topic = document.getElementById("topic").value;
    const count = document.getElementById("count").value;
    const model = document.getElementById("model").value;

    try {
      const response = await fetch(proxyBase + "/generate", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ topic, count, model }),
      });

      if (!response.ok) throw new Error("HTTP " + response.status);

      const json = await response.json();

      if (json?.data?.candidates) {
        let html = "";
        json.data.candidates.forEach((c, i) => {
          const text = c.content.parts.map(p => p.text).join("\n");

          html += `
            <div style="background:#1e293b; padding:15px; margin:10px 0; border-radius:10px; line-height:1.6; color:#f1f5f9;">
              <h3 style="color:#ffcc70;">üìÑ ‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ó‡∏ô‡∏ï‡πå #${i+1}</h3>
              <pre style="white-space:pre-wrap; font-family:inherit;">${text}</pre>
              <button onclick="copyToClipboard(\`${text.replace(/`/g, '\\`')}\`)" 
                style="margin-top:10px; padding:5px 10px; border:none; border-radius:5px; background:#3b82f6; color:#fff; cursor:pointer;">
                üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å
              </button>
            </div>
          `;
        });
        document.getElementById("results").innerHTML = html;
      } else if (json?.data?.error) {
        throw new Error(json.data.error.message);
      } else {
        throw new Error("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÑ‡∏î‡πâ");
      }
    } catch (err) {
      document.getElementById("results").innerHTML = "";
      document.getElementById("error").textContent = "‚ùå Error: " + err.message;
    }
  }

  function copyToClipboard(text) {
    navigator.clipboard.writeText(text).then(() => {
      alert("‚úÖ ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!");
    });
  }
</script>
